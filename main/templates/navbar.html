{% load static %}
<style>
  .gold-navbar {
    background: var(--nav-gradient, linear-gradient(135deg, #f6d365, #fda085)) !important;
    color: #fff;
    border-bottom: 1px solid rgba(0,0,0,.06);
    box-shadow: 0 .75rem 1.5rem rgba(0,0,0,.12);
  }
  .gold-navbar .navbar-brand,
  .gold-navbar .nav-link,
  .gold-navbar .navbar-toggler { color: #fff !important; }
  .gold-navbar .nav-link.active,
  .gold-navbar .nav-link:focus,
  .gold-navbar .nav-link:hover {
    color: #fff !important;
    background: rgba(255,255,255,.18);
    border-radius: 10px;
  }
  /* Default nav (non-champion/admin) */
  .navbar.bg-primary {
    background:#111827 !important;
    color:#fff;
  }
  .navbar.bg-primary .nav-link,
  .navbar.bg-primary .navbar-brand,
  .navbar.bg-primary .navbar-toggler { color:#fff !important; }
  body[data-champion-theme="gold"] { --nav-gradient: linear-gradient(135deg, #f6d365, #fda085); }
  body[data-champion-theme="emerald"] { --nav-gradient: linear-gradient(135deg, #a3f7c0, #4caf7a); }
  body[data-champion-theme="sapphire"] { --nav-gradient: linear-gradient(135deg, #b8ccff, #4f82f6); }
</style>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary" id="r19Nav">
    <div class="container">
        <a class="navbar-brand" href="/">ROOT 19</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/question-bank/">Question Bank</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/leaderboard/">Leaderboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/about/">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/report-bug/">Report Bug</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="legalDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Legal
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="legalDropdown">
                        <li><a class="dropdown-item" href="/terms/">Terms of Service</a></li>
                        <li><a class="dropdown-item" href="/privacy/">Privacy Policy</a></li>
                        <li><a class="dropdown-item" href="/disclaimer/">Disclaimer</a></li>
                    </ul>
                </li>
                {% if request.user.is_staff %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Admin Tools
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                        <li><a class="dropdown-item" href="/staff/user-activity/">Activity</a></li>
                        <li><a class="dropdown-item" href="/staff/bugs/">Bugs</a></li>
                        <li><a class="dropdown-item" href="/staff/password-requests/">Password Requests</a></li>
                        <li><a class="dropdown-item" href="/staff/theme-access/">Theme Access</a></li>
                        <li><a class="dropdown-item" href="/staff/reset-password/">Reset Password</a></li>
                    </ul>
                </li>
                {% endif %}
                {% if request.session.user_id %}
                <li class="nav-item">
                    <a class="nav-link" href="/user-stats/">ðŸ”¥ My Stats</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/progress/">Progress</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/saved/">Saved</a>
                </li>
                {% endif %}
            </ul>
            <ul class="navbar-nav ms-auto">
                {% if request.user.is_staff %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="themeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Theme
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end p-2 small" aria-labelledby="themeDropdown" style="min-width: 220px;">
                        <li class="px-2 pb-1 text-muted">Champion themes (admin preview)</li>
                        <li><button class="dropdown-item d-flex align-items-center gap-2 js-theme-choice" type="button" data-theme="gold"><span style="width:14px;height:14px;border-radius:50%;background:linear-gradient(135deg,#ffe08a,#f6b93b);display:inline-block;border:1px solid #f0b84a;"></span>Gold</button></li>
                        <li><button class="dropdown-item d-flex align-items-center gap-2 js-theme-choice" type="button" data-theme="emerald"><span style="width:14px;height:14px;border-radius:50%;background:linear-gradient(135deg,#a3f7c0,#4caf7a);display:inline-block;border:1px solid #4caf7a;"></span>Emerald</button></li>
                        <li><button class="dropdown-item d-flex align-items-center gap-2 js-theme-choice" type="button" data-theme="sapphire"><span style="width:14px;height:14px;border-radius:50%;background:linear-gradient(135deg,#b8ccff,#4f82f6);display:inline-block;border:1px solid #4f82f6;"></span>Sapphire</button></li>
                        <li><button class="dropdown-item d-flex align-items-center gap-2 js-theme-choice" type="button" data-theme="default"><span style="width:14px;height:14px;border-radius:50%;background:#f7f7f8;display:inline-block;border:1px solid #d1d5db;"></span>Reset to default</button></li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="px-2">
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox" id="navChampionMode" checked>
                                <label class="form-check-label" for="navChampionMode">Champion Mode</label>
                            </div>
                        </li>
                    </ul>
                </li>
                {% endif %}
                {% if request.session.champion_name %}
                <li class="nav-item">
                    <span class="nav-link disabled text-uppercase fw-semibold">Champion: {{ request.session.champion_name }}</span>
                </li>
                {% endif %}
                {% if request.session.user_name %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Welcome, {{ request.session.user_name }}
                        {% if streak_current %}
                            <span class="badge bg-warning-subtle text-warning ms-1">ðŸ”¥ {{ streak_current }}d</span>
                        {% endif %}
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="/change-password/">Change Password</a></li>
                        <li><a class="dropdown-item" href="/logout/">Logout</a></li>
                    </ul>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="/login/">Login</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/register/">Register</a>
                </li>
                {% endif %}
            </ul>
    </div>
  </div>
</nav>

<script>
  (function() {
    const nav = document.getElementById('r19Nav');
    const canGold = {{ request.user.is_staff|yesno:"true,false" }} || {{ request.session.is_champion|yesno:"true,false" }} || {{ request.session.champion_access|yesno:"true,false" }};
    if (!canGold || !nav) return;
    try {
      const savedTheme = localStorage.getItem('championTheme');
      const savedMode = localStorage.getItem('championMode');
      const defaultTheme = savedTheme || 'gold';
      const enabled = savedMode === 'on'; // default to off unless explicitly enabled
      document.body.dataset.championTheme = defaultTheme;
      document.body.dataset.championEnabled = enabled ? 'on' : 'off';
      if (enabled) {
        document.body.classList.add('champion-mode');
        nav.classList.remove('bg-primary');
        nav.classList.add('gold-navbar');
      } else {
        document.body.classList.remove('champion-mode');
        nav.classList.remove('gold-navbar');
        nav.classList.add('bg-primary');
        try { localStorage.setItem('championMode', 'off'); } catch (e) {}
      }
      try { if (!savedTheme) localStorage.setItem('championTheme', defaultTheme); } catch (e) {}
    } catch (e) {}
  })();

  document.addEventListener('DOMContentLoaded', () => {
    const nav = document.getElementById('r19Nav');
    const canGold = {{ request.user.is_staff|yesno:"true,false" }} || {{ request.session.is_champion|yesno:"true,false" }} || {{ request.session.champion_access|yesno:"true,false" }};
    if (!canGold || !nav) return;
    const modeToggle = document.getElementById('navChampionMode');
    const themeButtons = document.querySelectorAll('.js-theme-choice');

    const setMode = (on) => {
      document.body.classList.toggle('champion-mode', on);
      document.body.dataset.championEnabled = on ? 'on' : 'off';
      nav.classList.toggle('gold-navbar', on);
      nav.classList.toggle('bg-primary', !on);
      try { localStorage.setItem('championMode', on ? 'on' : 'off'); } catch (e) {}
    };

    const applyTheme = (theme) => {
      if (theme === 'default') {
        setMode(false);
        delete document.body.dataset.championTheme;
        try { localStorage.removeItem('championTheme'); } catch (e) {}
        return;
      }
      document.body.dataset.championTheme = theme;
      try { localStorage.setItem('championTheme', theme); } catch (e) {}
      setMode(true);
      if (modeToggle) modeToggle.checked = true;
    };

    // hydrate toggle state
    try {
      const savedMode = localStorage.getItem('championMode');
      if (modeToggle) modeToggle.checked = savedMode === 'on';
    } catch (e) {}

    themeButtons.forEach(btn => {
      btn.addEventListener('click', () => applyTheme(btn.dataset.theme));
    });

    if (modeToggle) {
      modeToggle.addEventListener('change', () => setMode(modeToggle.checked));
    }
  });
</script>
